<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>Book Details</title>
  <link rel="stylesheet" type="text/css" href="/css/bookDetails.css">
  <link href="https://fonts.cdnfonts.com/css/euclid-circular-b" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body class="background-details">
  <h1 class="title-name">Book details</h1>
  <div class="book-details">
    <img th:src="${book.thumbnailUrl}" th:alt="${book.title}" class="book-image" name="book-image" id="book-image" />
    <div class="vertical-line"></div>
    <div class="all-details">
      <h2 name="title" id="title" th:text="${book.title}" class="book-title"></h2>
      <p name="authors" id="authors" class="book-authors p3p" th:text="${book.authors}"></p>
      <p class="book-description p3p" th:text="${book.description}"></p>
      <p class="book-page-count p3p" th:text="'Page Count: ' + ${book.pageCount}"></p>
      <p class="book-published-date p3p" th:text="'Published Date: ' + ${book.publishedDate}"></p>
      <p class="book-average-rating p3p" th:text="'Average Rating: ' + ${book.averageRating}"></p>
      <input type="hidden" id="book-id" name="book-id" th:value="${book.id}" />
      <button type="button" class="favorite-btn">Favorite</button>
    </div>
  </div>
  <script>
    $(document).ready(function () {
      $(".favorite-btn").click(function () {
        var bookId = $(this).siblings("#book-id").val();
        var bookTitle = $(this).siblings("#title").text();
        var bookAuthors = $(this).siblings("#authors").text();
        var bookImage = $(this).closest(".book-details").find("#book-image").attr("src"); //.closest is to find in the other div "book-details"
        $.ajax({
          type: "POST",
          url: "/favorites/add",
          data: {
            id: bookId,
            name: bookTitle,
            authors: bookAuthors,
            image: bookImage
          },
          success: function (response) {
            alert("Book added to favorites!");
          },
          error: function (xhr) {
            alert("Error adding book to favorites.");
          }
        });
      });
    });  
   $(document).ready(function truncateDescription() {
  var maxLength = 200;
  var descriptions = document.getElementsByClassName("book-description");
  for (var i = 0; i < descriptions.length; i++) {
    (function(i) {
      var descriptionText = descriptions[i].textContent.trim();
      if (descriptionText.length > maxLength) {
        var truncatedText = descriptionText.substr(0, maxLength) + "...";
        descriptions[i].textContent = truncatedText;
        var readMoreLink = document.createElement("a");
        readMoreLink.textContent = "Read more";
        readMoreLink.href = "#";
        readMoreLink.addEventListener("click", function(event) {
          event.preventDefault();
          descriptions[i].textContent = descriptionText;
          this.style.display = "none";
        });
        descriptions[i].appendChild(readMoreLink);
      }
    })(i);
  }
});


  document.addEventListener("DOMContentLoaded", function() {
    truncateDescription();
  });
  </script>
</body>

</html>